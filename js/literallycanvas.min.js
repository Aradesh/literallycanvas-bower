!function(a){if("object"==typeof exports)module.exports=a();else if("function"==typeof define&&define.amd)define(a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.LC=a()}}(function(){return function d(a,b,c){function e(g,h){if(!b[g]){if(!a[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=b[g]={exports:{}};a[g][0].call(j.exports,function(b){var c=a[g][1][b];return e(c?c:b)},j,j.exports,d,a,b,c)}return b[g].exports}for(var f="function"==typeof require&&require,g=0;g<c.length;g++)e(c[g]);return e}({1:[function(){},{}],2:[function(a,b){var d,e,f,g,h,i,j,k,l,m,n,o=function(a,b){return function(){return a.apply(b,arguments)}},p=[].slice;h=a("./actions"),i=a("./bindEvents"),k=a("./math"),n=a("./shapes"),j=n.createShape,l=n.shapeToJSON,e=n.JSONToShape,g=a("../tools/Pencil"),m=a("./util"),d="infinite",b.exports=f=function(){function a(a,b){this.containerEl=a,this.setImageSize=o(this.setImageSize,this),i(this,this.containerEl,b.keyboardShortcuts),this.colors={primary:b.primaryColor||"#000",secondary:b.secondaryColor||"#fff",background:b.backgroundColor||"transparent"},this.watermarkImage=b.watermarkImage,this.watermarkScale=b.watermarkScale||1,this.backgroundCanvas=document.createElement("canvas"),this.backgroundCtx=this.backgroundCanvas.getContext("2d"),this.containerEl.appendChild(this.backgroundCanvas),this.backgroundShapes=b.backgroundShapes||[],this.canvas=document.createElement("canvas"),this.canvas.style["background-color"]="transparent",this.containerEl.appendChild(this.canvas),this.buffer=document.createElement("canvas"),this.buffer.style["background-color"]="transparent",this.ctx=this.canvas.getContext("2d"),this.bufferCtx=this.buffer.getContext("2d"),this.backingScale=m.getBackingScale(this.ctx),this.shapes=[],this.undoStack=[],this.redoStack=[],this.isDragging=!1,this.position={x:0,y:0},this.scale=1,this.tool=new g,this.width=b.imageSize.width||d,this.height=b.imageSize.height||d,this.setZoom(this.scale),m.matchElementSize(this.containerEl,[this.backgroundCanvas,this.canvas],this.backingScale,function(a){return function(){return a.keepPanInImageBounds(),a.repaintAllLayers()}}(this)),this.watermarkImage&&(this.watermarkImage.onload=function(a){return function(){return a.repaintLayer("background")}}(this))}return a.prototype.trigger=function(a,b){return this.canvas.dispatchEvent(new CustomEvent(a,{detail:b}))},a.prototype.on=function(a,b){var c;return c=function(a){return b(a.detail)},this.canvas.addEventListener(a,c),function(b){return function(){return b.canvas.removeEventListener(a,c)}}(this)},a.prototype.getRenderScale=function(){return this.scale*this.backingScale},a.prototype.clientCoordsToDrawingCoords=function(a,b){return{x:(a*this.backingScale-this.position.x)/this.getRenderScale(),y:(b*this.backingScale-this.position.y)/this.getRenderScale()}},a.prototype.drawingCoordsToClientCoords=function(a,b){return{x:a*this.getRenderScale()+this.position.x,y:b*this.getRenderScale()+this.position.y}},a.prototype.setImageSize=function(a,b){return this.width=a||d,this.height=b||d,this.keepPanInImageBounds(),this.repaintAllLayers(),this.trigger("imageSizeChange",{width:this.width,height:this.height})},a.prototype.setTool=function(a){return this.tool=a,this.trigger("toolChange",{tool:a})},a.prototype.begin=function(a,b){return m.requestAnimationFrame(function(c){return function(){var d;return d=c.clientCoordsToDrawingCoords(a,b),c.tool.begin(d.x,d.y,c),c.isDragging=!0,c.trigger("drawStart",{tool:c.tool})}}(this))},a.prototype["continue"]=function(a,b){return m.requestAnimationFrame(function(c){return function(){var d;return d=c.clientCoordsToDrawingCoords(a,b),c.isDragging?(c.tool["continue"](d.x,d.y,c),c.trigger("drawContinue",{tool:c.tool})):void 0}}(this))},a.prototype.end=function(a,b){return m.requestAnimationFrame(function(c){return function(){var d;return d=c.clientCoordsToDrawingCoords(a,b),c.isDragging?(c.tool.end(d.x,d.y,c),c.isDragging=!1,c.trigger("drawEnd",{tool:c.tool})):void 0}}(this))},a.prototype.setColor=function(a,b){switch(this.colors[a]=b,a){case"background":this.containerEl.style.backgroundColor=this.colors.background,this.repaintLayer("background");break;case"primary":this.repaintLayer("main");break;case"secondary":this.repaintLayer("main")}return this.trigger(""+a+"ColorChange",this.colors[a]),"background"===a?this.trigger("drawingChange"):void 0},a.prototype.getColor=function(a){return this.colors[a]},a.prototype.saveShape=function(a,b,c){return null==b&&(b=!0),null==c&&(c=null),c||(c=this.shapes.length?this.shapes[this.shapes.length-1].id:null),this.execute(new h.AddShapeAction(this,a,c)),b&&this.trigger("shapeSave",{shape:a,previousShapeId:c}),this.trigger("drawingChange")},a.prototype.pan=function(a,b){return this.setPan(this.position.x-a,this.position.y-b)},a.prototype.keepPanInImageBounds=function(){var a,b,c,e;return a=this.getRenderScale(),e=this.position,b=e.x,c=e.y,this.width!==d&&(b=this.canvas.width>this.width*a?(this.canvas.width-this.width*a)/2:Math.max(Math.min(0,b),this.canvas.width-this.width*a)),this.height!==d&&(c=this.canvas.height>this.height*a?(this.canvas.height-this.height*a)/2:Math.max(Math.min(0,c),this.canvas.height-this.height*a)),this.position={x:b,y:c}},a.prototype.setPan=function(a,b){return this.position={x:a,y:b},this.keepPanInImageBounds(),this.repaintAllLayers(),this.trigger("pan",{x:this.position.x,y:this.position.y})},a.prototype.zoom=function(a){var b;return b=this.scale+a,b=Math.max(b,.6),b=Math.min(b,4),b=Math.round(100*b)/100,this.setZoom(b)},a.prototype.setZoom=function(a){var b;return b=this.scale,this.scale=a,this.position.x=k.scalePositionScalar(this.position.x,this.canvas.width,b,this.scale),this.position.y=k.scalePositionScalar(this.position.y,this.canvas.height,b,this.scale),this.keepPanInImageBounds(),this.repaintAllLayers(),this.trigger("zoom",{oldScale:b,newScale:this.scale})},a.prototype.repaintAllLayers=function(){var a,b,c,d;for(d=["background","main"],b=0,c=d.length;c>b;b++)a=d[b],this.repaintLayer(a);return null},a.prototype.repaintLayer=function(a,b){var c;switch(null==b&&(b="main"===a),a){case"background":this.backgroundCtx.clearRect(0,0,this.backgroundCanvas.width,this.backgroundCanvas.height),this.watermarkImage&&this._renderWatermark(this.backgroundCtx),c=function(a){return function(){return a.repaintLayer("background")}}(this),this.draw(this.backgroundShapes,this.backgroundCtx,c);break;case"main":c=function(a){return function(){return a.repaintLayer("main",!0)}}(this),b&&(this.buffer.width=this.canvas.width,this.buffer.height=this.canvas.height,this.bufferCtx.clearRect(0,0,this.buffer.width,this.buffer.height),this.draw(this.shapes,this.bufferCtx,c)),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.canvas.width>0&&this.canvas.height>0&&(this.ctx.fillStyle="#ccc",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.clipped(function(a){return function(){return a.ctx.clearRect(0,0,a.canvas.width,a.canvas.height),a.ctx.drawImage(a.buffer,0,0)}}(this),this.ctx))}return this.trigger("repaint",{layerKey:a})},a.prototype._renderWatermark=function(a,b){return null==b&&(b=!0),a.save(),a.translate(a.canvas.width/2,a.canvas.height/2),a.scale(this.watermarkScale,this.watermarkScale),b&&a.scale(this.backingScale,this.backingScale),a.drawImage(this.watermarkImage,-this.watermarkImage.width/2,-this.watermarkImage.height/2),a.restore()},a.prototype.drawShapeInProgress=function(a){return this.repaintLayer("main",!1),this.clipped(function(b){return function(){return b.transformed(function(){return a.drawLatest(b.ctx,b.bufferCtx)},b.ctx,b.bufferCtx)}}(this),this.ctx,this.bufferCtx)},a.prototype.draw=function(a,b,c){var d;if(a.length)return d=function(){return function(){var d,e,f,g;for(g=[],e=0,f=a.length;f>e;e++)d=a[e],g.push(d.draw(b,c));return g}}(this),this.clipped(function(a){return function(){return a.transformed(d,b)}}(this),b)},a.prototype.clipped=function(){var a,b,c,e,f,g,h,i,j,k,l,m;for(c=arguments[0],a=2<=arguments.length?p.call(arguments,1):[],g=this.width===d?0:this.position.x,h=this.height===d?0:this.position.y,f=function(){switch(this.width){case d:return this.canvas.width;default:return this.width*this.getRenderScale()}}.call(this),e=function(){switch(this.height){case d:return this.canvas.height;default:return this.height*this.getRenderScale()}}.call(this),i=0,k=a.length;k>i;i++)b=a[i],b.save(),b.beginPath(),b.rect(g,h,f,e),b.clip();for(c(),m=[],j=0,l=a.length;l>j;j++)b=a[j],m.push(b.restore());return m},a.prototype.transformed=function(){var a,b,c,d,e,f,g,h,i;for(c=arguments[0],a=2<=arguments.length?p.call(arguments,1):[],e=0,g=a.length;g>e;e++)b=a[e],b.save(),b.translate(this.position.x,this.position.y),d=this.getRenderScale(),b.scale(d,d);for(c(),i=[],f=0,h=a.length;h>f;f++)b=a[f],i.push(b.restore());return i},a.prototype.clear=function(){var a,b;return b=this.shapes,a=[],this.execute(new h.ClearAction(this,b,a)),this.repaintLayer("main"),this.trigger("clear",null),this.trigger("drawingChange",{})},a.prototype.execute=function(a){return this.undoStack.push(a),a["do"](),this.redoStack=[]},a.prototype.undo=function(){var a;if(this.undoStack.length)return a=this.undoStack.pop(),a.undo(),this.redoStack.push(a),this.trigger("undo",{action:a}),this.trigger("drawingChange",{})},a.prototype.redo=function(){var a;if(this.redoStack.length)return a=this.redoStack.pop(),this.undoStack.push(a),a["do"](),this.trigger("redo",{action:a}),this.trigger("drawingChange",{})},a.prototype.canUndo=function(){return!!this.undoStack.length},a.prototype.canRedo=function(){return!!this.redoStack.length},a.prototype.getPixel=function(a,b){var c,d;return c=this.drawingCoordsToClientCoords(a,b),d=this.ctx.getImageData(c.x,c.y,1,1).data,d[3]?"rgb("+d[0]+", "+d[1]+", "+d[2]+")":null},a.prototype.getContentBounds=function(){return m.getBoundingRect(this.shapes.map(function(a){return a.getBoundingRect()}),this.width===d?0:this.width,this.height===d?0:this.height)},a.prototype.getImage=function(a){var b,c;return null==a&&(a={}),null==a.rect&&(a.rect=this.getContentBounds()),a.rect.width&&a.rect.height?(null==a.scale&&(a.scale=1),null==a.scaleDownRetina&&(a.scaleDownRetina=!0),null==a.includeWatermark&&(a.includeWatermark=this.watermarkImage&&!0),a.scaleDownRetina||(a.scale*=this.backingScale),this.repaintLayer("main",!0),b=document.createElement("canvas"),b.width=a.rect.width*a.scale,b.height=a.rect.height*a.scale,c=b.getContext("2d"),c.fillStyle=this.colors.background,c.fillRect(0,0,b.width,b.height),a.includeWatermark&&this._renderWatermark(c,!1),m.combineCanvases(b,m.renderShapes(this.backgroundShapes,a.rect,a.scale),m.renderShapes(this.shapes,a.rect,a.scale))):void 0},a.prototype.canvasForExport=function(){return this.repaintAllLayers(),m.combineCanvases(this.backgroundCanvas,this.canvas)},a.prototype.canvasWithBackground=function(a){return m.combineCanvases(a,this.canvasForExport())},a.prototype.getSnapshot=function(){var a;return{shapes:function(){var b,c,d,e;for(d=this.shapes,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(l(a));return e}.call(this),colors:this.colors}},a.prototype.getSnapshotJSON=function(){return JSON.stringify(this.getSnapshot())},a.prototype.loadSnapshot=function(a){var b,c,d,f,g,i,j,k,l;if(a){for(null==a.colors&&(a.colors=this.colors),k=["primary","secondary","background"],f=0,i=k.length;i>f;f++)b=k[f],this.setColor(b,a.colors[b]);for(this.shapes=[],l=a.shapes,g=0,j=l.length;j>g;g++)d=l[g],c=e(d),c&&this.execute(new h.AddShapeAction(this,c));return this.repaintAllLayers(),this.trigger("snapshotLoad"),this.trigger("drawingChange",{})}},a.prototype.loadSnapshotJSON=function(a){return this.loadSnapshot(JSON.parse(a))},a}()},{"../tools/Pencil":32,"./actions":3,"./bindEvents":4,"./math":7,"./shapes":8,"./util":9}],3:[function(a,b){var d,e;e=function(){function a(a,b,c){this.lc=a,this.oldShapes=b,this.newShapes=c}return a.prototype["do"]=function(){return this.lc.shapes=this.newShapes,this.lc.repaintLayer("main")},a.prototype.undo=function(){return this.lc.shapes=this.oldShapes,this.lc.repaintLaye("main")},a}(),d=function(){function a(a,b,c){this.lc=a,this.shape=b,this.previousShapeId=null!=c?c:null}return a.prototype["do"]=function(){var a,b,c,d,e,f;if(this.lc.shapes.length&&this.lc.shapes[this.lc.shapes.length-1].id!==this.previousShapeId&&null!==this.previousShapeId){for(b=[],a=!1,f=this.lc.shapes,d=0,e=f.length;e>d;d++)c=f[d],b.push(c),c.id===this.previousShapeId&&(b.push(this.shape),a=!0);a||b.push(this.shape),this.lc.shapes=b}else this.lc.shapes.push(this.shape);return this.lc.repaintLayer("main")},a.prototype.undo=function(){var a,b,c,d,e;if(this.lc.shapes[this.lc.shapes.length-1].id===this.shape.id)this.lc.shapes.pop();else{for(a=[],e=this.lc.shapes,c=0,d=e.length;d>c;c++)b=e[c],b.id!==this.shape.id&&a.push(b);lc.shapes=a}return this.lc.repaintLayer("main")},a}(),b.exports={ClearAction:e,AddShapeAction:d}},{}],4:[function(a,b){var d,e,f,g;f=function(a,b){var c,d,e;return d=b.changedTouches[0].clientX,e=b.changedTouches[0].clientY,c=a.getBoundingClientRect(),[d-c.left,e-c.top]},g=function(a,b){var c;return c=a.getBoundingClientRect(),{left:b.clientX-c.left,top:b.clientY-c.top}},e=function(a){return null!=a.buttons?1===a.buttons:a.which>0},b.exports=d=function(a,b,c){return null==c&&(c=!1),b.addEventListener("mousedown",function(){return function(c){var d,e;return d=!0,c.preventDefault(),document.onselectstart=function(){return!1},e=g(b,c),a.begin(e.left,e.top)}}(this)),document.addEventListener("mousemove",function(){return function(c){var d;return c.preventDefault(),d=g(b,c),a["continue"](d.left,d.top)}}(this)),document.addEventListener("mouseup",function(){return function(c){var d;return c.preventDefault(),document.onselectstart=function(){return!0},d=g(b,c),a.end(d.left,d.top)}}(this)),b.addEventListener("touchstart",function(c){return c.preventDefault(),1===c.touches.length?a.begin.apply(a,f(b,c)):a["continue"].apply(a,f(b,c))}),b.addEventListener("touchmove",function(c){return c.preventDefault(),a["continue"].apply(a,f(b,c))}),b.addEventListener("touchend",function(c){return c.preventDefault(),a.end.apply(a,f(b,c))}),b.addEventListener("touchcancel",function(c){return c.preventDefault(),a.end.apply(a,f(b,c))}),c?document.addEventListener("keydown",function(b){switch(b.keyCode){case 37:a.pan(-10,0);break;case 38:a.pan(0,-10);break;case 39:a.pan(10,0);break;case 40:a.pan(0,10)}return a.repaintAllLayers()}):void 0}},{}],5:[function(a,b){b.exports={arrow:function(a,b,c,d,e){return null==e&&(e={}),null==e.width&&(e.width=Math.max(2.2*a.lineWidth,5)),null==e.length&&(e.length=e.width),null==e.color&&(e.color=a.strokeStyle),a.fillStyle=e.color,a.lineWidth=0,a.strokeStyle="transparent",a.beginPath(),a.moveTo(b+Math.cos(d+Math.PI/2)*e.width/2,c+Math.sin(d+Math.PI/2)*e.width/2),a.lineTo(b+Math.cos(d)*e.length,c+Math.sin(d)*e.length),a.lineTo(b+Math.cos(d-Math.PI/2)*e.width/2,c+Math.sin(d-Math.PI/2)*e.width/2),a.fill()}}},{}],6:[function(a,b){var d,e,f;e={},d=function(a){return e=a},f=function(a){var b;return b=e[a],b||a},b.exports={localize:d,_:f}},{}],7:[function(a,b){var d,e,f,g,h,i;d=a("./shapes").Point,h=a("./util"),e={},e.toPoly=function(a){var b,c,d,e,g,h,j;for(e=[],g=[],b=0,h=0,j=a.length;j>h;h++)d=a[h],c=f(d,i(a,b)),e=e.concat([c[0]]),g=[c[1]].concat(g),b+=1;return e.concat(g)},i=function(a,b){var c;return a.length<3&&(c={x:0,y:0}),c=0===b?i(a,b+1):b===a.length-1?i(a,b-1):e.diff(a[b-1],a[b+1])},e.diff=function(a,b){return{x:b.x-a.x,y:b.y-a.y}},g=function(a){var b;return b=e.len(a),{x:a.x/b,y:a.y/b}},f=function(a,b){return b=g(b),b.x=b.x*a.size/2,b.y=b.y*a.size/2,[{x:a.x-b.y,y:a.y+b.x,color:a.color},{x:a.x+b.y,y:a.y-b.x,color:a.color}]},e.len=function(a){return Math.sqrt(Math.pow(a.x,2)+Math.pow(a.y,2))},e.scalePositionScalar=function(a,b,c,d){var e,f;return f=b*c,e=b*d,a+(f-e)/2},b.exports=e},{"./shapes":8,"./util":9}],8:[function(a,b){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s=[].slice;m=a("./util"),i=a("../core/lineEndCapShapes.coffee"),l={},h=function(a,b){var c,d;c=function(){var a,c;return a=1<=arguments.length?s.call(arguments,0):[],(c=b.constructor).call.apply(c,[this].concat(s.call(a))),this},c.prototype.className=a,c.fromJSON=b.fromJSON,c.prototype.drawLatest=function(a,b){return this.draw(a,b)};for(d in b)"fromJSON"!==d&&(c.prototype[d]=b[d]);return l[a]=c,c},g=function(){var a,b,c;return b=arguments[0],a=2<=arguments.length?s.call(arguments,1):[],c=function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b);return Object(e)===e?e:d}(l[b],a,function(){}),c.id=m.getGUID(),c},d=function(a){var b,c,d,e;return b=a.className,c=a.data,d=a.id,b in l?(e=l[b].fromJSON(c),e?(d&&(e.id=d),e):(console.log("Unreadable shape:",b,c),null)):(console.log("Unknown shape:",b,c),null)},k=function(a){return{className:a.className,data:a.toJSON(),id:a.id}},f=function(a,b){return b?f(p(p(r(a))),b-1):a},r=function(a){var b,c,d,e,f;for(a=[a[0]].concat(a).concat(m.last(a)),d=[],b=0,e=0,f=a.length;f>e;e++)c=a[e],d[2*b]=c,a[b+1]&&(d[2*b+1]=q(c,a[b+1])),b+=1;return d},p=function(a){var b,c,d,e,f;for(b=[],c=0,e=0,f=a.length;f>e;e++)d=a[e],a[c+1]&&(b[c]=q(d,a[c+1])),c+=1;return b},q=function(a,b){return g("Point",{x:a.x+(b.x-a.x)/2,y:a.y+(b.y-a.y)/2,size:a.size+(b.size-a.size)/2,color:a.color})},h("Image",{constructor:function(a){return null==a&&(a={}),this.x=a.x||0,this.y=a.y||0,this.image=a.image||null},draw:function(a,b){return this.image.width?a.drawImage(this.image,this.x,this.y):this.image.onload=b},getBoundingRect:function(){return{x:this.x,y:this.y,width:this.image.width,height:this.image.height}},toJSON:function(){return{x:this.x,y:this.y,imageSrc:this.image.src}},fromJSON:function(a){var b;return b=new Image,b.src=a.imageSrc,g("Image",{x:a.x,y:a.y,image:b})}}),h("Rectangle",{constructor:function(a){return null==a&&(a={}),this.x=a.x||0,this.y=a.y||0,this.width=a.width||0,this.height=a.height||0,this.strokeWidth=a.strokeWidth||1,this.strokeColor=a.strokeColor||"black",this.fillColor=a.fillColor||"transparent"},draw:function(a){return a.fillStyle=this.fillColor,a.fillRect(this.x,this.y,this.width,this.height),a.lineWidth=this.strokeWidth,a.strokeStyle=this.strokeColor,a.strokeRect(this.x,this.y,this.width,this.height)},getBoundingRect:function(){return{x:this.x-this.strokeWidth/2,y:this.y-this.strokeWidth/2,width:this.width+this.strokeWidth,height:this.height+this.strokeWidth}},toJSON:function(){return{x:this.x,y:this.y,width:this.width,height:this.height,strokeWidth:this.strokeWidth,strokeColor:this.strokeColor,fillColor:this.fillColor}},fromJSON:function(a){return g("Rectangle",a)}}),h("Ellipse",{constructor:function(a){return null==a&&(a={}),this.x=a.x||0,this.y=a.y||0,this.width=a.width||0,this.height=a.height||0,this.strokeWidth=a.strokeWidth||1,this.strokeColor=a.strokeColor||"black",this.fillColor=a.fillColor||"transparent"},draw:function(a){var b,c,d,e;return a.save(),e=Math.floor(this.width/2),d=Math.floor(this.height/2),b=this.x+e,c=this.y+d,a.translate(b,c),a.scale(1,Math.abs(this.height/this.width)),a.beginPath(),a.arc(0,0,Math.abs(e),0,2*Math.PI),a.closePath(),a.restore(),a.fillStyle=this.fillColor,a.fill(),a.lineWidth=this.strokeWidth,a.strokeStyle=this.strokeColor,a.stroke()},getBoundingRect:function(){return{x:this.x-this.strokeWidth/2,y:this.y-this.strokeWidth/2,width:this.width+this.strokeWidth,height:this.height+this.strokeWidth}},toJSON:function(){return{x:this.x,y:this.y,width:this.width,height:this.height,strokeWidth:this.strokeWidth,strokeColor:this.strokeColor,fillColor:this.fillColor}},fromJSON:function(a){return g("Ellipse",a)}}),h("Line",{constructor:function(a){return null==a&&(a={}),this.x1=a.x1||0,this.y1=a.y1||0,this.x2=a.x2||0,this.y2=a.y2||0,this.strokeWidth=a.strokeWidth||1,this.strokeStyle=a.strokeStyle||null,this.color=a.color||"black",this.capStyle=a.capStyle||"round",this.endCapShapes=a.endCapShapes||[null,null],this.dash=a.dash||null},draw:function(a){return a.lineWidth=this.strokeWidth,a.strokeStyle=this.color,a.lineCap=this.capStyle,this.dash&&a.setLineDash(this.dash),a.beginPath(),a.moveTo(this.x1,this.y1),a.lineTo(this.x2,this.y2),a.stroke(),this.dash&&a.setLineDash([]),this.endCapShapes[0]&&i[this.endCapShapes[0]](a,this.x1,this.y1,Math.atan2(this.y1-this.y2,this.x1-this.x2),{color:this.color}),this.endCapShapes[1]?i[this.endCapShapes[1]](a,this.x2,this.y2,Math.atan2(this.y2-this.y1,this.x2-this.x1),{color:this.color}):void 0},getBoundingRect:function(){return{x:Math.min(this.x1,this.x2)-this.strokeWidth/2,y:Math.min(this.y1,this.y2)-this.strokeWidth/2,width:Math.abs(this.x2-this.x1)+this.strokeWidth/2,height:Math.abs(this.y2-this.y1)+this.strokeWidth/2}},toJSON:function(){return{x1:this.x1,y1:this.y1,x2:this.x2,y2:this.y2,strokeWidth:this.strokeWidth,color:this.color,capStyle:this.capStyle,dash:this.dash,endCapShapes:this.endCapShapes}},fromJSON:function(a){return g("Line",a)}}),o=function(a){var b,c,d,e,f;if(!a.length)return!1;for(d=a[0].size,b=a[0].color,e=0,f=a.length;f>e;e++)if(c=a[e],(c.size!==d||c.color!==b)&&console.log(d,b,c.size,c.color),c.size!==d||c.color!==b)return!1;return!0},n=function(a,b){var c,e,f,h;return e=null,b.points?e=function(){var a,e,f,g;for(f=b.points,g=[],a=0,e=f.length;e>a;a++)c=f[a],g.push(d(c));return g}():b.pointCoordinatePairs&&(e=function(){var a,c,e,g,i;for(e=b.pointCoordinatePairs,i=[],a=0,c=e.length;c>a;a++)g=e[a],f=g[0],h=g[1],i.push(d({className:"Point",data:{x:f,y:h,size:b.pointSize,color:b.pointColor,smooth:b.smooth}}));return i}()),e[0]?g(a,{points:e,order:b.order,tailSize:b.tailSize,smooth:b.smooth}):null},j={constructor:function(a){var b,c,d,e,f;null==a&&(a={}),c=a.points||[],this.order=a.order||3,this.tailSize=a.tailSize||3,this.smooth="smooth"in a?a.smooth:!0,this.segmentSize=Math.pow(2,this.order),this.sampleSize=this.tailSize+1,this.points=[],f=[];for(d=0,e=c.length;e>d;d++)b=c[d],f.push(this.addPoint(b));return f},getBoundingRect:function(){return m.getBoundingRect(this.points.map(function(a){return{x:a.x-a.size/2,y:a.y-a.size/2,width:a.size,height:a.size}}))},toJSON:function(){var a,b;return o(this.points)?{order:this.order,tailSize:this.tailSize,smooth:this.smooth,pointCoordinatePairs:function(){var a,c,d,e;for(d=this.points,e=[],a=0,c=d.length;c>a;a++)b=d[a],e.push([b.x,b.y]);return e}.call(this),pointSize:this.points[0].size,pointColor:this.points[0].color}:{order:this.order,tailSize:this.tailSize,smooth:this.smooth,points:function(){var b,c,d,e;for(d=this.points,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(k(a));return e}.call(this)}},fromJSON:function(a){return n("LinePath",a)},draw:function(a){return this.drawPoints(a,this.smoothedPoints)},drawLatest:function(a,b){var c,d,e;return this.drawPoints(a,this.tail?this.tail:this.smoothedPoints),this.tail?(e=this.smoothedPoints.length-this.segmentSize*this.tailSize,d=e<2*this.segmentSize?0:e,c=e+this.segmentSize+1,this.drawPoints(b,this.smoothedPoints.slice(d,c))):void 0},addPoint:function(a){return this.points.push(a),this.smooth?!this.smoothedPoints||this.points.length<this.sampleSize?this.smoothedPoints=f(this.points,this.order):(this.tail=m.last(f(m.last(this.points,this.sampleSize),this.order),this.segmentSize*this.tailSize),this.smoothedPoints=this.smoothedPoints.slice(0,this.smoothedPoints.length-this.segmentSize*(this.tailSize-1)).concat(this.tail)):this.smoothedPoints=this.points},drawPoints:function(a,b){var c,d,e,f;if(b.length){for(a.lineCap="round",a.strokeStyle=b[0].color,a.lineWidth=b[0].size,a.beginPath(),a.moveTo(b[0].x,b[0].y),f=b.slice(1),d=0,e=f.length;e>d;d++)c=f[d],a.lineTo(c.x,c.y);return a.stroke()}}},e=h("LinePath",j),h("ErasedLinePath",{constructor:j.constructor,toJSON:j.toJSON,addPoint:j.addPoint,drawPoints:j.drawPoints,getBoundingRect:j.getBoundingRect,draw:function(a){return a.save(),a.globalCompositeOperation="destination-out",j.draw.call(this,a),a.restore()},drawLatest:function(a,b){return a.save(),a.globalCompositeOperation="destination-out",b.save(),b.globalCompositeOperation="destination-out",j.drawLatest.call(this,a,b),a.restore(),b.restore()},fromJSON:function(a){return n("ErasedLinePath",a)}}),h("Point",{constructor:function(a){return null==a&&(a={}),this.x=a.x||0,this.y=a.y||0,this.size=a.size||0,this.color=a.color||""},lastPoint:function(){return this},draw:function(){throw"not implemented"},toJSON:function(){return{x:this.x,y:this.y,size:this.size,color:this.color}},fromJSON:function(a){return g("Point",a)}}),h("Text",{constructor:function(a){return null==a&&(a={}),this.x=a.x||0,this.y=a.y||0,this.text=a.text||"",this.color=a.color||"black",this.font=a.font||"18px sans-serif"},draw:function(a){return a.font=this.font,a.fillStyle=this.color,a.fillText(this.text,this.x,this.y),this.boundingBoxWidth=Math.ceil(a.measureText(this.text).width)},getBoundingRect:function(){return{x:this.x,y:this.y,width:this.boundingBoxWidth,height:18}},toJSON:function(){return{x:this.x,y:this.y,text:this.text,color:this.color,font:this.font}},fromJSON:function(a){return g("Text",a)}}),b.exports={defineShape:h,createShape:g,JSONToShape:d,shapeToJSON:k}},{"../core/lineEndCapShapes.coffee":5,"./util":9}],9:[function(a,b){var d,e,f,g=[].slice;e=Array.prototype.slice,d=function(){var a;try{return(window.requestAnimationFrame||window.setTimeout).bind(window)}catch(b){a=b}},f={last:function(a,b){return null==b&&(b=null),b?e.call(a,Math.max(a.length-b,0)):a[a.length-1]},matchElementSize:function(a,b,c,d){var e;return null==d&&(d=function(){}),e=function(){return function(){var e,f,g;for(f=0,g=b.length;g>f;f++)e=b[f],e.style.width=""+a.offsetWidth+"px",e.style.height=""+a.offsetHeight+"px",null!=e.width&&(e.setAttribute("width",e.offsetWidth*c),e.setAttribute("height",e.offsetHeight*c));return d()}}(this),a.addEventListener("resize",e),window.addEventListener("resize",e),window.addEventListener("orientationchange",e),e()},combineCanvases:function(){var a,b,c,d,e,f,h,i;for(c=1<=arguments.length?g.call(arguments,0):[],a=document.createElement("canvas"),a.width=c[0].width,a.height=c[0].height,e=0,h=c.length;h>e;e++)b=c[e],a.width=Math.max(b.width,a.width),a.height=Math.max(b.height,a.height);for(d=a.getContext("2d"),f=0,i=c.length;i>f;f++)b=c[f],d.drawImage(b,0,0),d.drawImage(b,0,0);return a},renderShapes:function(a,b,c,d){var e,f,g,h;for(null==c&&(c=1),null==d&&(d=null),d=d||document.createElement("canvas"),d.width=b.width*c,d.height=b.height*c,e=d.getContext("2d"),e.translate(-b.x*c,-b.y*c),e.scale(c,c),g=0,h=a.length;h>g;g++)f=a[g],f.draw(e);return d},getBoundingRect:function(a,b,c){var d,e,f,g,h,i,j;if(!a.length)return{x:0,y:0,width:0||b,height:0||c};for(f=a[0].x,g=a[0].y,d=a[0].x+a[0].width,e=a[0].y+a[0].height,i=0,j=a.length;j>i;i++)h=a[i],f=Math.floor(Math.min(h.x,f)),g=Math.floor(Math.min(h.y,g)),d=Math.ceil(Math.max(d,h.x+h.width)),e=Math.ceil(Math.max(e,h.y+h.height));return f=b?0:f,g=c?0:g,d=b||d,e=c||e,{x:f,y:g,width:d-f,height:e-g}},getBackingScale:function(){return null==window.devicePixelRatio?1:window.devicePixelRatio>1?window.devicePixelRatio:1},requestAnimationFrame:d(),getGUID:function(){var a;return a=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},function(){return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}}()},b.exports=f},{}],10:[function(a,b){var d,e,f,g,h,i,j,k,l,m,n,o;d=a("./core/LiterallyCanvas"),i=a("./reactGUI/init"),m=a("./core/shapes"),o=a("./core/util"),j=a("./core/localization").localize,a("./optionsStyles/font"),a("./optionsStyles/stroke-width"),a("./optionsStyles/line-options-and-stroke-width"),a("./optionsStyles/null"),g=a("./optionsStyles/optionsStyles").defineOptionsStyle,e=a("./tools/base"),n={Pencil:a("./tools/Pencil"),Eraser:a("./tools/Eraser"),Line:a("./tools/Line"),Rectangle:a("./tools/Rectangle"),Ellipse:a("./tools/Ellipse"),Text:a("./tools/Text"),Pan:a("./tools/Pan"),Eyedropper:a("./tools/Eyedropper"),Tool:e.Tool,ToolWithStroke:e.ToolWithStroke},f="lib/img",l=function(a){return f=a},h=function(a,b){var c,e,g,h,j,k,l,m;null==b&&(b={}),null==b.imageURLPrefix&&(b.imageURLPrefix=f),null==b.primaryColor&&(b.primaryColor="#000"),null==b.secondaryColor&&(b.secondaryColor="#fff"),null==b.backgroundColor&&(b.backgroundColor="transparent"),null==b.keyboardShortcuts&&(b.keyboardShortcuts=!0),null==b.imageSize&&(b.imageSize={width:"infinite",height:"infinite"}),null==b.backgroundShapes&&(b.backgroundShapes=[]),null==b.watermarkImage&&(b.watermarkImage=null),null==b.watermarkScale&&(b.watermarkScale=1),"tools"in b||(b.tools=[n.Pencil,n.Eraser,n.Line,n.Rectangle,n.Ellipse,n.Text,n.Pan,n.Eyedropper]),m=a.children;for(k=0,l=m.length;l>k;k++)c=m[k],a.removeChild(c);return-1===[" "," "].join(a.className).indexOf(" literally ")&&(a.className=a.className+" literally"),j=document.createElement("div"),j.className="lc-picker",e=document.createElement("div"),e.className="lc-drawing",h=document.createElement("div"),h.className="lc-options",a.appendChild(j),a.appendChild(e),a.appendChild(h),g=new d(e,b),i(j,h,g,b.tools,b.imageURLPrefix),"onInit"in b&&b.onInit(g),g},k=function(a){return a.fn.literallycanvas=function(a){return null==a&&(a={}),this.each(function(){return function(b,c){return c.literallycanvas=h(c,a)}}(this)),this}},window.LC={init:h},window.$&&k(window.$),b.exports={init:h,registerJQueryPlugin:k,util:o,tools:n,defineOptionsStyle:g,setDefaultImageURLPrefix:l,defineShape:m.defineShape,createShape:m.createShape,JSONToShape:m.JSONToShape,shapeToJSON:m.shapeToJSON,localize:j}},{"./core/LiterallyCanvas":2,"./core/localization":6,"./core/shapes":8,"./core/util":9,"./optionsStyles/font":11,"./optionsStyles/line-options-and-stroke-width":12,"./optionsStyles/null":13,"./optionsStyles/optionsStyles":14,"./optionsStyles/stroke-width":15,"./reactGUI/init":26,"./tools/Ellipse":27,"./tools/Eraser":28,"./tools/Eyedropper":29,"./tools/Line":30,"./tools/Pan":31,"./tools/Pencil":32,"./tools/Rectangle":33,"./tools/Text":34,"./tools/base":35}],11:[function(a,b){var d,e;d=a("./optionsStyles").defineOptionsStyle,e=a("../core/localization")._,d("font",React.createClass({displayName:"FontOptions",getText:function(){var a;return null!=(a=this.props.lc.tool)?a.text:void 0},getInitialState:function(){return{text:this.getText(),isItalic:!1,isBold:!1,fontFamilyIndex:0,fontSizeIndex:4}},getFontSizes:function(){return[9,10,12,14,18,24,36,48,64,72,96,144,288]},getFamilies:function(){var a;return a=this.props.lc,[{name:e("Sans-serif"),value:'"Helvetica Neue",Helvetica,Arial,sans-serif'},{name:e("Serif"),value:'"Hoefler Text","Times New Roman",serif'},{name:e("Typewriter"),value:'"Lucida Typewriter",monospace'}]},updateTool:function(a){var b,c,d;null==a&&(a={});for(d in this.state)d in a||(a[d]=this.state[d]);return b=this.getFontSizes()[a.fontSizeIndex],c=[],a.isItalic&&c.push("italic"),a.isBold&&c.push("bold"),c.push(""+b+"px"),c.push(this.getFamilies()[a.fontFamilyIndex].value),this.props.lc.tool.font=c.join(" ")},handleText:function(a){return this.props.lc.tool.text=a.target.value,this.setState({text:this.getText()})},handleFontSize:function(a){var b;return b={fontSizeIndex:a.target.value},this.setState(b),this.updateTool(b)},handleFontFamily:function(a){var b;return b={fontFamilyIndex:a.target.value},this.setState(b),this.updateTool(b)},handleItalic:function(){var b;return b={isItalic:!this.state.isItalic},this.setState(b),this.updateTool(b)},handleBold:function(){var b;return b={isBold:!this.state.isBold},this.setState(b),this.updateTool(b)},componentDidMount:function(){return this.updateTool()},render:function(){var a,b,c,d,f,g,h,i,j;return f=this.props.lc,j=React.DOM,b=j.div,c=j.input,h=j.select,g=j.option,a=j.br,d=j.label,i=j.span,b({className:"lc-font-settings"},c({type:"text",placeholder:e("Enter text here"),value:this.state.text,onChange:this.handleText}),i({className:"instructions"},e("Click and hold to place text.")),a(),e("Size: "),h({value:this.state.fontSizeIndex,onChange:this.handleFontSize},this.getFontSizes().map(function(){return function(a,b){return g({value:b,key:b},a)
}}(this))),h({value:this.state.fontFamilyIndex,onChange:this.handleFontFamily},this.getFamilies().map(function(){return function(a,b){return g({value:b,key:b},a.name)}}(this))),d({htmlFor:"italic"},c({type:"checkbox",id:"italic",checked:this.state.isItalic,onChange:this.handleItalic},e("italic"))),d({htmlFor:"bold"},c({type:"checkbox",id:"bold",checked:this.state.isBold,onChange:this.handleBold},e("bold"))))}})),b.exports={}},{"../core/localization":6,"./optionsStyles":14}],12:[function(a,b){var d,e,f;f=a("./optionsStyles").defineOptionsStyle,d=a("../reactGUI/StrokeWidthPicker"),e=a("../reactGUI/createSetStateOnEventMixin"),f("line-options-and-stroke-width",React.createClass({displayName:"LineOptionsAndStrokeWidth",getState:function(){return{strokeWidth:this.props.tool.strokeWidth,isDashed:this.props.tool.isDashed,hasEndArrow:this.props.tool.hasEndArrow}},getInitialState:function(){return this.getState()},mixins:[e("toolChange")],render:function(){var a,b,c,e,f,g,h,i,j;return j=React.DOM,c=j.div,i=j.ul,f=j.li,e=j.img,g=function(a){return function(){return a.props.tool.isDashed=!a.props.tool.isDashed,a.setState(a.getState())}}(this),h=function(a){return function(){return a.props.tool.hasEndArrow=!a.props.tool.hasEndArrow,a.setState(a.getState())}}(this),b=React.addons.classSet({"basic-button square-button":!0,selected:this.state.isDashed}),a=React.addons.classSet({"basic-button square-button":!0,selected:this.state.hasEndArrow}),c({},i({className:"button-row",style:{"float":"left",marginRight:20}},f({},c({className:b,onClick:g},e({src:""+this.props.imageURLPrefix+"/dashed-line.png"}))),f({},c({className:a,onClick:h},e({src:""+this.props.imageURLPrefix+"/line-with-arrow.png"})))),d({tool:this.props.tool,lc:this.props.lc}))}})),b.exports={}},{"../reactGUI/StrokeWidthPicker":21,"../reactGUI/createSetStateOnEventMixin":24,"./optionsStyles":14}],13:[function(a,b){var d;d=a("./optionsStyles").defineOptionsStyle,d("null",React.createClass({displayName:"NoOptions",render:function(){return React.DOM.div()}})),b.exports={}},{"./optionsStyles":14}],14:[function(a,b){var d,e;e={},d=function(a,b){return e[a]=b},b.exports={optionsStyles:e,defineOptionsStyle:d}},{}],15:[function(a,b){var d,e;e=a("./optionsStyles").defineOptionsStyle,d=a("../reactGUI/StrokeWidthPicker"),e("stroke-width",d),b.exports={}},{"../reactGUI/StrokeWidthPicker":21,"./optionsStyles":14}],16:[function(a,b){var d,e,f,g;e=a("./React-shim"),f=a("./createSetStateOnEventMixin"),g=a("../core/localization")._,d=e.createClass({displayName:"ClearButton",getState:function(){return{isEnabled:this.props.lc.canUndo()}},getInitialState:function(){return this.getState()},mixins:[f("drawingChange")],render:function(){var a,b,c,d;return b=e.DOM.div,c=this.props.lc,a=e.addons.classSet({"lc-clear":!0,"toolbar-button":!0,"fat-button":!0,disabled:!this.state.isEnabled}),d=c.canUndo()?function(){return function(){return c.clear()}}(this):function(){},b({className:a,onClick:d},g("Clear"))}}),b.exports=d},{"../core/localization":6,"./React-shim":20,"./createSetStateOnEventMixin":24}],17:[function(a,b){var d,e;e=a("./React-shim"),d=e.createClass({displayName:"ColorWell",getState:function(){return{color:this.props.lc.colors[this.props.colorName],isPickerVisible:!1}},getInitialState:function(){return this.getState()},componentDidMount:function(){return this.unsubscribe=this.props.lc.on(""+this.props.colorName+"ColorChange",function(a){return function(){return a.setState({color:a.props.lc.colors[a.props.colorName]})}}(this))},componentWillUnmount:function(){return this.unsubscribe()},togglePicker:function(){return this.setState({isPickerVisible:!this.state.isPickerVisible})},closePicker:function(){return this.setState({isPickerVisible:!1})},setColor:function(a){return this.props.lc.setColor(this.props.colorName,a)},render:function(){var a,b,c;return c=e.DOM,a=c.div,b=c.label,a({className:"toolbar-button color-well-label",onMouseLeave:this.closePicker,onClick:this.togglePicker},b({style:{display:"block",clear:"both"}},this.props.label),a({className:e.addons.classSet({"color-well-container":!0,selected:this.state.isPickerVisible}),style:{backgroundColor:"white"}},a({className:"color-well-checker"}),a({className:"color-well-checker",style:{left:"50%",top:"50%"}}),a({className:"color-well-color",style:{backgroundColor:this.state.color}}," "),this.renderPicker()))},renderPicker:function(){var a,b,c,d,f,g,h,i;if(a=e.DOM.div,!this.state.isPickerVisible)return null;for(d=function(b){return function(){return a({className:"color-row",key:0,style:{height:20}},a({className:e.addons.classSet({"color-cell transparent-cell":!0,selected:"transparent"===b.state.color}),onClick:function(){return b.setColor("transparent")}},"transparent"))}}(this),f=[],"background"===this.props.colorName&&f.push("transparent"),f.push(function(){var a,b;for(b=[],c=a=0;100>=a;c=a+=10)b.push("hsl(0, 0%, "+c+"%)");return b}()),i=[0,30,60,90,120,150,180,210,240,270,300,330],g=0,h=i.length;h>g;g++)b=i[g],f.push(function(){var a,d;for(d=[],c=a=10;90>=a;c=a+=8)d.push("hsl("+b+", 100%, "+c+"%)");return d}());return a({className:"color-picker-popup"},f.map(function(b){return function(c,f){return"transparent"===c?d():a({className:"color-row",key:f,style:{width:20*c.length}},c.map(function(c,d){var f;return f=e.addons.classSet({"color-cell":!0,selected:b.state.color===c}),a({className:f,onClick:function(){return b.setColor(c)},style:{backgroundColor:c},key:d})}))}}(this)))}}),b.exports=d},{"./React-shim":20}],18:[function(a,b){var d,e,f,g;e=a("./React-shim"),f=a("./createSetStateOnEventMixin"),g=a("../optionsStyles/optionsStyles").optionsStyles,d=e.createClass({displayName:"Options",getState:function(){var a;return{style:null!=(a=this.props.lc.tool)?a.optionsStyle:void 0,tool:this.props.lc.tool}},getInitialState:function(){return this.getState()},mixins:[f("toolChange")],render:function(){var a;return a=""+this.state.style,g[a]({lc:this.props.lc,tool:this.state.tool,imageURLPrefix:this.props.imageURLPrefix})}}),b.exports=d},{"../optionsStyles/optionsStyles":14,"./React-shim":20,"./createSetStateOnEventMixin":24}],19:[function(a,b){var d,e,f,g,h,i,j,k;h=a("./React-shim"),d=a("./ClearButton"),f=a("./ColorWell"),i=a("./UndoRedoButtons"),j=a("./ZoomButtons"),k=a("../core/localization")._,e=h.createClass({displayName:"ColorPickers",render:function(){var a,b;return b=this.props.lc,a=h.DOM.div,a({className:"lc-color-pickers"},f({lc:b,colorName:"background",label:k("background")}),f({lc:b,colorName:"primary",label:k("stroke")}),f({lc:b,colorName:"secondary",label:k("fill")}))}}),g=h.createClass({displayName:"Picker",getInitialState:function(){return{selectedToolIndex:0}},render:function(){var a,b,c,f,g;return a=h.DOM.div,g=this.props,f=g.toolButtonComponents,c=g.lc,b=g.imageURLPrefix,a({className:"lc-picker-contents"},f.map(function(a){return function(d,e){return d({lc:c,imageURLPrefix:b,key:e,isSelected:e===a.state.selectedToolIndex,onSelect:function(b){return c.setTool(b),a.setState({selectedToolIndex:e})}})}}(this)),0!==f.length%2?a({className:"toolbar-button thin-button disabled"}):void 0,i({lc:c,imageURLPrefix:b}),j({lc:c,imageURLPrefix:b}),d({lc:c}),e({lc:c}))}}),b.exports=g},{"../core/localization":6,"./ClearButton":16,"./ColorWell":17,"./React-shim":20,"./UndoRedoButtons":22,"./ZoomButtons":23}],20:[function(a,b){var d;try{d=a("React/addons")}catch(e){d=window.React}if(null==(null!=d?d.addons:void 0))throw"Can't find React (you need the version with addons)";b.exports=d},{}],21:[function(a,b){var d;d=a("../reactGUI/createSetStateOnEventMixin"),b.exports=React.createClass({displayName:"StrokeWidthPicker",getState:function(){return{strokeWidth:this.props.tool.strokeWidth}},getInitialState:function(){return this.getState()},mixins:[d("toolChange")],render:function(){var a,b,c,d,e,f,g,h;return h=React.DOM,g=h.ul,d=h.li,f=h.svg,a=h.circle,b=h.div,e=[1,2,5,10,20,30],c=function(){return function(){}}(this),g({className:"button-row"},e.map(function(c){return function(e){var h,i;return h=React.addons.classSet({"basic-button":!0,selected:e===c.state.strokeWidth}),i=30,d({className:"lc-stroke-width",key:e},b({className:h,onClick:function(){return c.props.tool.strokeWidth=e,c.setState(c.getState())}},f({width:i,height:i,viewPort:"0 0 "+e+" "+e,version:"1.1",xmlns:"http://www.w3.org/2000/svg"},a({cx:Math.ceil(i/2),cy:Math.ceil(i/2),r:e/2}))))}}(this)))}})},{"../reactGUI/createSetStateOnEventMixin":24}],22:[function(a,b){var d,e,f,g,h,i;d=a("./React-shim"),h=a("./createSetStateOnEventMixin"),i=function(a){return d.createClass({displayName:"undo"===a?"UndoButton":"RedoButton",getState:function(){return{isEnabled:function(){switch(!1){case"undo"!==a:return this.props.lc.canUndo();case"redo"!==a:return this.props.lc.canRedo()}}.call(this)}},getInitialState:function(){return this.getState()},mixins:[h("drawingChange")],render:function(){var b,c,e,f,g,h,i,j,k;return j=d.DOM,c=j.div,f=j.img,k=this.props,g=k.lc,e=k.imageURLPrefix,i="undo"===a?"Undo":"Redo",b="lc-"+a+" "+d.addons.classSet({"toolbar-button":!0,"thin-button":!0,disabled:!this.state.isEnabled}),h=function(){switch(!1){case!!this.state.isEnabled:return function(){};case"undo"!==a:return function(){return g.undo()};case"redo"!==a:return function(){return g.redo()}}}.call(this),c({className:b,onClick:h,title:i},f({src:""+e+"/"+a+".png"}))}})},f=i("undo"),e=i("redo"),g=d.createClass({displayName:"UndoRedoButtons",render:function(){var a;return a=d.DOM.div,a({className:"lc-undo-redo"},f(this.props),e(this.props))}}),b.exports=g},{"./React-shim":20,"./createSetStateOnEventMixin":24}],23:[function(a,b){var d,e,f,g,h,i;d=a("./React-shim"),h=a("./createSetStateOnEventMixin"),i=function(a){return d.createClass({displayName:"in"===a?"ZoomInButton":"ZoomOutButton",getState:function(){return{isEnabled:function(){switch(!1){case"in"!==a:return this.props.lc.scale<4;case"out"!==a:return this.props.lc.scale>.6}}.call(this)}},getInitialState:function(){return this.getState()},mixins:[h("zoom")],render:function(){var b,c,e,f,g,h,i,j,k;return j=d.DOM,c=j.div,f=j.img,k=this.props,g=k.lc,e=k.imageURLPrefix,i="in"===a?"Zoom in":"Zoom out",b="lc-zoom-"+a+" "+d.addons.classSet({"toolbar-button":!0,"thin-button":!0,disabled:!this.state.isEnabled}),h=function(){switch(!1){case!!this.state.isEnabled:return function(){};case"in"!==a:return function(){return g.zoom(.2)};case"out"!==a:return function(){return g.zoom(-.2)}}}.call(this),c({className:b,onClick:h,title:i},f({src:""+e+"/zoom-"+a+".png"}))}})},g=i("out"),f=i("in"),e=d.createClass({displayName:"ZoomButtons",render:function(){var a;return a=d.DOM.div,a({className:"lc-zoom"},g(this.props),f(this.props))}}),b.exports=e},{"./React-shim":20,"./createSetStateOnEventMixin":24}],24:[function(a,b){var d,e;d=a("./React-shim"),b.exports=e=function(a){return{componentDidMount:function(){return this.unsubscribe=this.props.lc.on(a,function(a){return function(){return a.setState(a.getState())}}(this))},componentWillUnmount:function(){return this.unsubscribe()}}}},{"./React-shim":20}],25:[function(a,b){var d,e;d=a("./React-shim"),e=function(a){var b,c,e,f;return b=a.displayName,c=a.getTool,e=a.imageName,f=c(),d.createClass({displayName:b,getDefaultProps:function(){return{isSelected:!1,lc:null}},componentWillMount:function(){return this.props.isSelected?this.props.lc.setTool(f):void 0},render:function(){var a,c,g,h,i,j,k,l;return k=d.DOM,c=k.div,h=k.img,l=this.props,g=l.imageURLPrefix,i=l.isSelected,j=l.onSelect,a=d.addons.classSet({"lc-pick-tool":!0,"toolbar-button":!0,"thin-button":!0,selected:i}),c({className:a,onClick:function(){return j(f)},title:b},h({className:"lc-tool-icon",src:""+g+"/"+e+".png"}))}})},b.exports=e},{"./React-shim":20}],26:[function(a,b){var d,e,f,g,h;f=a("./React-shim"),g=a("./createToolButton"),d=a("./Options"),e=a("./Picker"),h=function(a,b,c,h,i){var j;return j=h.map(function(a){var b;return b=new a,g({displayName:b.name,imageName:b.iconName,getTool:function(){return b}})}),f.renderComponent(e({lc:c,toolButtonComponents:j,imageURLPrefix:i}),a),f.renderComponent(d({lc:c,imageURLPrefix:i}),b)},b.exports=h},{"./Options":18,"./Picker":19,"./React-shim":20,"./createToolButton":25}],27:[function(a,b){var d,e,f,g={}.hasOwnProperty,h=function(a,b){function d(){this.constructor=a}for(var c in b)g.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};e=a("./base").ToolWithStroke,f=a("../core/shapes").createShape,b.exports=d=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return h(b,a),b.prototype.name="Ellipse",b.prototype.iconName="ellipse",b.prototype.begin=function(a,b,c){return this.currentShape=f("Ellipse",{x:a,y:b,strokeWidth:this.strokeWidth,strokeColor:c.getColor("primary"),fillColor:c.getColor("secondary")})},b.prototype["continue"]=function(a,b,c){return this.currentShape.width=a-this.currentShape.x,this.currentShape.height=b-this.currentShape.y,c.drawShapeInProgress(this.currentShape)},b.prototype.end=function(a,b,c){return c.saveShape(this.currentShape)},b}(e)},{"../core/shapes":8,"./base":35}],28:[function(a,b){var d,e,f,g={}.hasOwnProperty,h=function(a,b){function d(){this.constructor=a}for(var c in b)g.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};e=a("./Pencil"),f=a("../core/shapes").createShape,b.exports=d=function(a){function b(){this.strokeWidth=10}return h(b,a),b.prototype.name="Eraser",b.prototype.iconName="eraser",b.prototype.makePoint=function(a,b){return f("Point",{x:a,y:b,size:this.strokeWidth,color:"#000"})},b.prototype.makeShape=function(){return f("ErasedLinePath")},b}(e)},{"../core/shapes":8,"./Pencil":32}],29:[function(a,b){var d,e,f,g={}.hasOwnProperty,h=function(a,b){function d(){this.constructor=a}for(var c in b)g.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};e=a("./base").Tool,f=a("../core/shapes").createShape,b.exports=d=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return h(b,a),b.prototype.name="Eyedropper",b.prototype.iconName="eyedropper",b.prototype.readColor=function(a,b,c){var d;return d=c.getPixel(a,b),c.setColor("primary",d||c.getColor("background"))},b.prototype.begin=function(a,b,c){return this.readColor(a,b,c)},b.prototype["continue"]=function(a,b,c){return this.readColor(a,b,c)},b}(e)},{"../core/shapes":8,"./base":35}],30:[function(a,b){var d,e,f,g={}.hasOwnProperty,h=function(a,b){function d(){this.constructor=a}for(var c in b)g.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};e=a("./base").Tool,f=a("../core/shapes").createShape,b.exports=d=function(a){function b(){this.strokeWidth=5}return h(b,a),b.prototype.name="Line",b.prototype.iconName="line",b.prototype.optionsStyle="line-options-and-stroke-width",b.prototype.begin=function(a,b,c){return this.currentShape=f("Line",{x1:a,y1:b,x2:a,y2:b,strokeWidth:this.strokeWidth,dash:function(){switch(!1){case!this.isDashed:return[2*this.strokeWidth,4*this.strokeWidth];default:return null}}.call(this),endCapShapes:this.hasEndArrow?[null,"arrow"]:null,color:c.getColor("primary")})},b.prototype["continue"]=function(a,b,c){return this.currentShape.x2=a,this.currentShape.y2=b,c.drawShapeInProgress(this.currentShape)},b.prototype.end=function(a,b,c){return c.saveShape(this.currentShape)},b}(e)},{"../core/shapes":8,"./base":35}],31:[function(a,b){var d,e,f,g={}.hasOwnProperty,h=function(a,b){function d(){this.constructor=a}for(var c in b)g.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};e=a("./base").Tool,f=a("../core/shapes").createShape,b.exports=d=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return h(b,a),b.prototype.name="Pan",b.prototype.iconName="pan",b.prototype.begin=function(a,b){return this.start={x:a,y:b}},b.prototype["continue"]=function(a,b,c){return c.pan(this.start.x-a,this.start.y-b),c.repaintAllLayers()},b.prototype.end=function(a,b,c){return c.repaintAllLayers()},b}(e)},{"../core/shapes":8,"./base":35}],32:[function(a,b){var d,e,f,g={}.hasOwnProperty,h=function(a,b){function d(){this.constructor=a}for(var c in b)g.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};e=a("./base").ToolWithStroke,f=a("../core/shapes").createShape,b.exports=d=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return h(b,a),b.prototype.name="Pencil",b.prototype.iconName="pencil",b.prototype.eventTimeThreshold=10,b.prototype.begin=function(a,b,c){return this.color=c.getColor("primary"),this.currentShape=this.makeShape(),this.currentShape.addPoint(this.makePoint(a,b,c)),this.lastEventTime=Date.now()},b.prototype["continue"]=function(a,b,c){var d;return d=Date.now()-this.lastEventTime,d>this.eventTimeThreshold?(this.lastEventTime+=d,this.currentShape.addPoint(this.makePoint(a,b,c)),c.drawShapeInProgress(this.currentShape)):void 0},b.prototype.end=function(a,b,c){return c.saveShape(this.currentShape),this.currentShape=void 0},b.prototype.makePoint=function(a,b){return f("Point",{x:a,y:b,size:this.strokeWidth,color:this.color})},b.prototype.makeShape=function(){return f("LinePath")},b}(e)},{"../core/shapes":8,"./base":35}],33:[function(a,b){var d,e,f,g={}.hasOwnProperty,h=function(a,b){function d(){this.constructor=a}for(var c in b)g.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};e=a("./base").ToolWithStroke,f=a("../core/shapes").createShape,b.exports=d=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return h(b,a),b.prototype.name="Rectangle",b.prototype.iconName="rectangle",b.prototype.begin=function(a,b,c){return this.currentShape=f("Rectangle",{x:a,y:b,strokeWidth:this.strokeWidth,strokeColor:c.getColor("primary"),fillColor:c.getColor("secondary")})},b.prototype["continue"]=function(a,b,c){return this.currentShape.width=a-this.currentShape.x,this.currentShape.height=b-this.currentShape.y,c.drawShapeInProgress(this.currentShape)},b.prototype.end=function(a,b,c){return c.saveShape(this.currentShape)},b}(e)},{"../core/shapes":8,"./base":35}],34:[function(a,b){var d,e,f,g={}.hasOwnProperty,h=function(a,b){function d(){this.constructor=a}for(var c in b)g.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};e=a("./base").Tool,f=a("../core/shapes").createShape,b.exports=d=function(a){function b(a,b){this.text=null!=a?a:"",this.font=null!=b?b:"bold 18px sans-serif"}return h(b,a),b.prototype.name="Text",b.prototype.iconName="text",b.prototype.setText=function(a){return this.text=a},b.prototype.begin=function(a,b,c){return this.color=c.getColor("primary"),this.currentShape=f("Text",{x:a,y:b,text:this.text,color:this.color,font:this.font})},b.prototype["continue"]=function(a,b,c){return this.currentShape.x=a,this.currentShape.y=b,c.drawShapeInProgress(this.currentShape)},b.prototype.end=function(a,b,c){return c.saveShape(this.currentShape)},b.prototype.optionsStyle="font",b}(e)},{"../core/shapes":8,"./base":35}],35:[function(a,b){var d,e,f,g={}.hasOwnProperty,h=function(a,b){function d(){this.constructor=a}for(var c in b)g.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};f={},f.Tool=d=function(){function a(){}return a.prototype.name=null,a.prototype.iconName=null,a.prototype.begin=function(){},a.prototype["continue"]=function(){},a.prototype.end=function(){},a.prototype.optionsStyle=null,a}(),f.ToolWithStroke=e=function(a){function b(){this.strokeWidth=5}return h(b,a),b.prototype.optionsStyle="stroke-width",b}(d),b.exports=f},{}]},{},[10])(10)});